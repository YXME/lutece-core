<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc" xmlns:p="http://www.springframework.org/schema/p"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd">

    <bean id="appProperties" class="java.util.Properties">
        <constructor-arg
            value="#{ T(fr.paris.lutece.portal.service.util.AppPropertiesService).getProperties() }" />
    </bean>

    <context:property-placeholder properties-ref="appProperties" />

    <context:annotation-config />
    <import resource="jpa_context.xml" />
    <!-- Admin Authentication -->
    <bean id="passwordFactory" class="fr.paris.lutece.portal.business.user.authentication.PasswordFactory" />
    <bean id="adminAuthenticationModule"
          class="fr.paris.lutece.portal.business.user.authentication.LuteceDefaultAdminAuthentication">
        <property name="dao" ref="luteceDefaultAdminUserDAO" />
        <!--<property name="dataSourceFactory" ref="dataSourceFactory" /> -->
    </bean>

    <!-- Admin User Import Service -->
    <bean id="adminUserImportService" class="fr.paris.lutece.portal.service.admin.DefaultImportAdminUserService" />

    <bean id="luteceDefaultAdminUserDAO"
          class="fr.paris.lutece.portal.business.user.authentication.LuteceDefaultAdminUserDAO" />
    <bean id="defaultFileDownloadUrlService" class="fr.paris.lutece.portal.service.file.implementation.DefaultFileDownloadService" />
    <bean id="defaultFileNoRBACService" class="fr.paris.lutece.portal.service.file.implementation.DefaultFileNoRBACService" />
    
    <bean id="localDatabaseFileService" class="fr.paris.lutece.portal.service.file.implementation.LocalDatabaseFileService" >
            <constructor-arg ref="defaultFileDownloadUrlService" />
            <constructor-arg ref="defaultFileNoRBACService" />
            <property name="default" value="true" />
            <property name="name" value="defaultDatabaseFileStoreProvider" />
    </bean>   
    <!-- annotation db -->
    <!-- scans WEB-INF/lib for classes within jars, and web-inf/classes for .class -->
    <bean id="annotationDB" class="fr.paris.lutece.util.annotation.ScannotationDB">
        <!-- Uncomment the following lines and set your own regexp to filter scannable jar. If not set, annotation db will 
        use a default property that matches lutece jars only. For example, (sample\.jar)|(another-.*\.jar) will match sample.jar 
        and another-randomtext.jar. -->
        <!-- <property name="fileFilter">(sample\.jar)|(another-.*\.jar)</property> -->
    </bean>
    <!-- Preferences Services -->
    <bean id="userPreferencesDAO" class="fr.paris.lutece.portal.business.prefs.UserPreferencesDAO" />
    <bean id="adminUserPreferencesDAO" class="fr.paris.lutece.portal.business.prefs.AdminUserPreferencesDAO" />

    <bean id="userPreferencesService" class="fr.paris.lutece.portal.service.prefs.PortalUserPreferenceServiceImpl"
          scope="singleton">
        <property name="dao" ref="userPreferencesDAO" />
    </bean>
    <bean id="adminUserPreferencesService"
          class="fr.paris.lutece.portal.service.prefs.BaseUserPreferencesServiceImpl">
        <property name="dao" ref="adminUserPreferencesDAO" />
    </bean>

    <!-- Daemon management -->
    <bean id="daemonQueue" class="java.util.concurrent.LinkedBlockingQueue" />
    <bean id="daemonExecutorQueue" class="java.util.concurrent.SynchronousQueue" />
    <bean id="daemonThreadFactory" class="fr.paris.lutece.portal.service.daemon.DaemonThreadFactory" />
    <bean id="daemonExecutor" class="java.util.concurrent.ThreadPoolExecutor">
        <constructor-arg index="0" value="${daemon.ScheduledThreadCorePoolSize:1}" /> <!-- corePoolSize -->
        <constructor-arg index="1" value="${daemon.maximumPoolSize:30}" /> <!-- maximumPoolSize -->
        <constructor-arg index="2" value="${daemon.keepAliveTime:60}" /> <!-- keepAliveTime -->
        <constructor-arg index="3" value="${daemon.timeUnit:SECONDS}" /> <!-- unit -->
        <constructor-arg index="4" ref="daemonExecutorQueue" /> <!-- workQueue -->
        <constructor-arg index="5" ref="daemonThreadFactory" /> <!-- threadFactory -->
    </bean>
    <bean id="daemonScheduler" class="fr.paris.lutece.portal.service.daemon.DaemonScheduler">
        <constructor-arg ref="daemonQueue" />
        <constructor-arg ref="daemonExecutor" />
    </bean>

    <bean id="daemonThread" class="fr.paris.lutece.portal.service.daemon.DaemonThread" scope="prototype" />

    <!-- CSS frameworks management -->
    <!-- The default framework should have the its key value equals to 'default' -->
    <bean id="commonsBoostrap5Tabler" class="fr.paris.lutece.portal.business.template.CommonsInclude">
        <property name="key" value="Bootstrap5Tabler" />
         <property name="default" value="true" />
        <property name="name" value="Tabler 1.0.0" />
        <property name="files">
            <list>
                <value>commons_bs5_tabler.html</value>
                <value>commons_backport.html</value>
				<value>admin/util/calendar/macro_datetimepicker.html</value>
            </list>
        </property>
    </bean>
    <bean id="commonsCorporate" class="fr.paris.lutece.portal.business.template.CommonsInclude">
        <property name="key" value="Corporate" />
         <property name="default" value="false" />
        <property name="name" value="Corporate 0.0.1" />
        <property name="files">
            <list>
                <value>commons_corporate.html</value>
                <value>commons_backport.html</value>
                <value>admin/util/calendar/macro_datetimepicker.html</value>
            </list>
        </property>
    </bean>
</beans>
